OverheadSpellTransform = {}
OverheadSpellTransform.WordsNum_ON = 1
OverheadSpellTransform.WordsNum_OFF = 2
OverheadSpellTransform.WordsNum_MIXED = 3
OverheadSpellTransform.WordsNum_ENGLISH = 4
OverheadSpellTransform.WordsNum = OverheadSpellTransform.WordsNum_ON
OverheadSpellTransform.WordsQuickRegex = nil
OverheadSpellTransform.Words ={}
-- Magery
OverheadSpellTransform.Words[1] = { name = "Ex Uus", desc = "Agility" }
OverheadSpellTransform.Words[2] = { name = "Vas An Nox", desc = "Arch Cure" }
OverheadSpellTransform.Words[3] = { name = "Vas Uus Sanct", desc = "Arch Protection" }
OverheadSpellTransform.Words[4] = { name = "In Jux Hur Ylem", desc = "Blade Spirits" }
OverheadSpellTransform.Words[5] = { name = "Rel Sanct", desc = "Bless" }
OverheadSpellTransform.Words[6] = { name = "Vas Ort Grav", desc = "Chain Lightning" }
OverheadSpellTransform.Words[7] = { name = "Uus Jux", desc = "Clumsy" }
OverheadSpellTransform.Words[8] = { name = "In Mani Yelm", desc = "Create Food" }
OverheadSpellTransform.Words[9] = { name = "Uus Wis", desc = "Cunning" }
OverheadSpellTransform.Words[10] = { name = "An Nox", desc = "Cure" }
OverheadSpellTransform.Words[11] = { name = "Des Sanct", desc = "Curse" }
OverheadSpellTransform.Words[12] = { name = "An Ort", desc = "Dispel" }
OverheadSpellTransform.Words[13] = { name = "An Grav", desc = "Dispel Field" }
OverheadSpellTransform.Words[14] = { name = "In Vas Por", desc = "Earthquake" }
OverheadSpellTransform.Words[15] = { name = "Corp Por", desc = "Energy Bolt" }
OverheadSpellTransform.Words[16] = { name = "In Sanct Grav", desc = "Energy Field" }
OverheadSpellTransform.Words[17] = { name = "Vas Corp Por", desc = "Energy Vortex" }
OverheadSpellTransform.Words[18] = { name = "Vas Ort Flam", desc = "Explosion" }
OverheadSpellTransform.Words[19] = { name = "Rel Wis", desc = "Feeblemind" }
OverheadSpellTransform.Words[20] = { name = "In Flam Grav", desc = "Fire Field" }
OverheadSpellTransform.Words[21] = { name = "Vas Flam", desc = "Fireball" }
OverheadSpellTransform.Words[22] = { name = "Kal Vas Flam", desc = "Flamestrike" }
OverheadSpellTransform.Words[23] = { name = "Vas Rel Por", desc = "Gate Travel" }
OverheadSpellTransform.Words[24] = { name = "In Vas Mani", desc = "Greater Heal" }
OverheadSpellTransform.Words[25] = { name = "An Mani", desc = "Harm" }
OverheadSpellTransform.Words[26] = { name = "In Mani", desc = "Heal" }
OverheadSpellTransform.Words[27] = { name = "Kal In Ex", desc = "Incognito" }
OverheadSpellTransform.Words[28] = { name = "An Lor Xen", desc = "Invisibility" }
OverheadSpellTransform.Words[29] = { name = "Por Ort Grav", desc = "Lightning" }
OverheadSpellTransform.Words[30] = { name = "In Por Ylem", desc = "Magic Arrow" }
OverheadSpellTransform.Words[31] = { name = "An Por", desc = "Magic Lock" }
OverheadSpellTransform.Words[32] = { name = "In Jux Sanct", desc = "Magic Reflection" }
OverheadSpellTransform.Words[33] = { name = "In Jux", desc = "Magic Trap" }
OverheadSpellTransform.Words[34] = { name = "An Jux", desc = "Magic Untrap" }
OverheadSpellTransform.Words[35] = { name = "Ort Rel", desc = "Mana Drain" }
OverheadSpellTransform.Words[36] = { name = "Ort Sanct", desc = "Mana Vampire" }
OverheadSpellTransform.Words[37] = { name = "Kal Por Ylem", desc = "Mark" }
OverheadSpellTransform.Words[38] = { name = "Vas Des Sanct", desc = "Mass Curse" }
OverheadSpellTransform.Words[39] = { name = "Vas An Ort", desc = "Mass Dispel" }
OverheadSpellTransform.Words[40] = { name = "Flam Kal Des Ylem", desc = "Meteor Swarm" }
OverheadSpellTransform.Words[41] = { name = "Por Corp Wis", desc = "Mind Blast" }
OverheadSpellTransform.Words[42] = { name = "In Lor", desc = "Nightsight" }
OverheadSpellTransform.Words[43] = { name = "An Ex Por", desc = "Paralyze" }
OverheadSpellTransform.Words[44] = { name = "In Ex Grav", desc = "Paralyze Field" }
OverheadSpellTransform.Words[45] = { name = "In Nox", desc = "Poison" }
OverheadSpellTransform.Words[46] = { name = "In Nox Grav", desc = "Poison Field" }
OverheadSpellTransform.Words[47] = { name = "Vas Ylem Rel", desc = "Polymorph" }
OverheadSpellTransform.Words[48] = { name = "Uus Sanct", desc = "Protection" }
OverheadSpellTransform.Words[49] = { name = "Flam Sanct", desc = "Reactive Armor" }
OverheadSpellTransform.Words[50] = { name = "Kal Ort Por", desc = "Recall" }
OverheadSpellTransform.Words[51] = { name = "An Corp", desc = "Resurrection" }
OverheadSpellTransform.Words[52] = { name = "Wis Quas", desc = "Reveal" }
OverheadSpellTransform.Words[53] = { name = "Uus Mani", desc = "Strength" }
OverheadSpellTransform.Words[54] = { name = "Kal Xen", desc = "Summ. Creature" }
OverheadSpellTransform.Words[55] = { name = "Kal Vas Xen Hur", desc = "Summon Air Elemental" }
OverheadSpellTransform.Words[56] = { name = "Kal Vas Xen Corp", desc = "Summon Daemon" }
OverheadSpellTransform.Words[57] = { name = "Kal Vas Xen Ylem", desc = "Summon Earth Elemental" }
OverheadSpellTransform.Words[58] = { name = "Kal Vas Xen Flam", desc = "Summon Fire Elemental" }
OverheadSpellTransform.Words[59] = { name = "Kal Vas Xen An Flam", desc = "Summon Water Elemental" }
OverheadSpellTransform.Words[60] = { name = "Ort Por Ylem", desc = "Telekinesis" }
OverheadSpellTransform.Words[61] = { name = "Rel Por", desc = "Teleport" }
OverheadSpellTransform.Words[62] = { name = "Ex Por", desc = "Unlock" }
OverheadSpellTransform.Words[63] = { name = "In Sanct Ylem", desc = "Wall of Stone" }
OverheadSpellTransform.Words[64] = { name = "Des Mani", desc = "Weaken" }

-- Necromancy
OverheadSpellTransform.Words[65] = { name = "In Aglo Corp Ylem", desc = "Corpse Skin" }
OverheadSpellTransform.Words[66] = { name = "In Bal Nox", desc = "Strangle" }
OverheadSpellTransform.Words[67] = { name = "In Jux Mani Xen", desc = "Blood Oath" }
OverheadSpellTransform.Words[68] = { name = "In Sar", desc = "Pain Spike" }
OverheadSpellTransform.Words[69] = { name = "In Vas Nox", desc = "Poison Strike" }
OverheadSpellTransform.Words[70] = { name = "Kal Vas An Flam", desc = "Wither" }
OverheadSpellTransform.Words[71] = { name = "Kal Xen Bal", desc = "Summon Familiar" }
OverheadSpellTransform.Words[72] = { name = "Kal Xen Bal Beh", desc = "Vengeful Spirit" }
OverheadSpellTransform.Words[73] = { name = "Ort Corp Grav", desc = "Exorcism" }
OverheadSpellTransform.Words[74] = { name = "Pas Tym An Sanct", desc = "Evil Omen" }
OverheadSpellTransform.Words[75] = { name = "Rel Xen An Sanct", desc = "Vampiric Embrace" }
OverheadSpellTransform.Words[76] = { name = "Rel Xen Corp Ort", desc = "Lich Form" }
OverheadSpellTransform.Words[77] = { name = "Rel Xen Um", desc = "Wraith Form" }
OverheadSpellTransform.Words[78] = { name = "Rel Xen Vas Bal", desc = "Horrific Beast" }
OverheadSpellTransform.Words[79] = { name = "Uus Corp", desc = "Animate Dead" }
OverheadSpellTransform.Words[80] = { name = "Wis An Ben", desc = "Mind Rot" }

-- Spellweaving
OverheadSpellTransform.Words[81] = { name = "Alalithra", desc = "Summon Fey" }
OverheadSpellTransform.Words[82] = { name = "Anathrae", desc = "Essense of Wind" }
OverheadSpellTransform.Words[83] = { name = "Aslavdra", desc = "Arcane Empowerment" }
OverheadSpellTransform.Words[84] = { name = "Erelonia", desc = "Thunderstorm" }
OverheadSpellTransform.Words[85] = { name = "Haeldril", desc = "Attunement" }
OverheadSpellTransform.Words[86] = { name = "Haelyn", desc = "Wildfire" }
OverheadSpellTransform.Words[87] = { name = "Illorae", desc = "Gift of Life" }
OverheadSpellTransform.Words[88] = { name = "Myrshalee", desc = "Arcane Circle" }
OverheadSpellTransform.Words[89] = { name = "Nylisstra", desc = "Summon Fiend" }
OverheadSpellTransform.Words[90] = { name = "Nyraxle", desc = "Word of Death" }
OverheadSpellTransform.Words[91] = { name = "Olorisstra", desc = "Gift of Renewal" }
OverheadSpellTransform.Words[92] = { name = "Orlavdra", desc = "Ethereal Voyage" }
OverheadSpellTransform.Words[93] = { name = "Rathril", desc = "Dryad Allure" }
OverheadSpellTransform.Words[94] = { name = "Rauvvrae", desc = "Nature's Fury" }
OverheadSpellTransform.Words[95] = { name = "Tarisstree", desc = "Reaper Form" }
OverheadSpellTransform.Words[96] = { name = "Thalshara", desc = "Immolating Weapon" }

-- Chivalry
OverheadSpellTransform.Words[97] = { name = "Augus Luminos", desc = "Holy Light" }
OverheadSpellTransform.Words[98] = { name = "Consecrus Arma", desc = "Consecrate Weapon" }
OverheadSpellTransform.Words[99] = { name = "Dispiro Malas", desc = "Dispel Evil" }
OverheadSpellTransform.Words[100] = { name = "Dium Prostra", desc = "Noble Sacrifice" }
OverheadSpellTransform.Words[101] = { name = "Divinum Furis", desc = "Divine Fury" }
OverheadSpellTransform.Words[102] = { name = "Expor Flamus", desc = "Cleanse by Fire" }
OverheadSpellTransform.Words[103] = { name = "Extermo Vomica", desc = "Remove Curse" }
OverheadSpellTransform.Words[104] = { name = "Forul Solum", desc = "Enemy of One" }
OverheadSpellTransform.Words[105] = { name = "Obsu Vulni", desc = "Close Wounds" }
OverheadSpellTransform.Words[106] = { name = "Sanctum Viatas", desc = "Sacred Journey" }

-- Mysticism
OverheadSpellTransform.Words[107] = { name = "In Corp Ylem", desc = "Nether Bolt" }
OverheadSpellTransform.Words[108] = { name = "Kal In Mani", desc = "Healing Stone" }
OverheadSpellTransform.Words[109] = { name = "An Ort Sanct", desc = "Purge Magic" }
OverheadSpellTransform.Words[110] = { name = "In Ort Ylem", desc = "Enchant" }
OverheadSpellTransform.Words[111] = { name = "In Zu", desc = "Sleep" }
OverheadSpellTransform.Words[112] = { name = "Kal Por Xen", desc = "Eagle Strike" }
OverheadSpellTransform.Words[113] = { name = "In Jux Por Ylem", desc = "Animated Weapon" }
OverheadSpellTransform.Words[114] = { name = "In Rel Ylem", desc = "Stone Form" }
OverheadSpellTransform.Words[115] = { name = "In Vas Ort Ex", desc = "Spell Trigger" }
OverheadSpellTransform.Words[116] = { name = "Vas Zu", desc = "Mass Sleep" }
OverheadSpellTransform.Words[117] = { name = "In Vas Mani Hur", desc = "Cleansing Winds" }
OverheadSpellTransform.Words[118] = { name = "Corp Por Ylem", desc = "Bombard" }
OverheadSpellTransform.Words[119] = { name = "Vas Rel Jux Ort", desc = "Spell Plague" }
OverheadSpellTransform.Words[120] = { name = "Kal Des Ylem", desc = "Hail Storm" }
OverheadSpellTransform.Words[121] = { name = "Grav Hur", desc = "Nether Cyclone" }
OverheadSpellTransform.Words[122] = { name = "Kal Vas Xen Corp Ylem", desc = "Rising Colossus" }

OverheadSpellTransform.TypeSettingName = "OverheadSpellTransformType"

function OverheadSpellTransform.Initialize()
    CustomSettingsWindow.AddComboSetting( "Journal", "OverheadSpellTransformType", OverheadSpellTransform.TypeSettingName, 1, { "Spell Words Only", "Nothing", "Spells and English", "English Only" } )
    
    OverheadSpellTransform.PrepareWordsRegex()
    
    OverheadSpellTransform.ShowOverheadText = OverheadText.ShowOverheadText
    OverheadText.ShowOverheadText = OverheadSpellTransform.ShowOverheadTextPreprocess
end

function OverheadSpellTransform.PrepareWordsRegex()
    local regex = { "[", "[", "[", "[", "[" }
    for i,v in ipairs( OverheadSpellTransform.Words ) do
        local chars = {}
        for i2,v2 in ipairs( regex ) do
            local char = string.sub(v.name, i2, i2)
            if string.find( regex[i2], char ) == nil then
                regex[i2] = v2..char
            end
        end
    end
    OverheadSpellTransform.WordsQuickRegex = "^"
    for i,v in ipairs( regex ) do
        OverheadSpellTransform.WordsQuickRegex = OverheadSpellTransform.WordsQuickRegex..v.."]"
    end
end

function OverheadSpellTransform.ShowOverheadTextPreprocess()
    local currentSpell = CustomSettings.LoadNumberValue( { settingName=OverheadSpellTransform.TypeSettingName, defaultValue=1 } )
    if currentSpell > 1 then
        local textAsString = WStringToString( SystemData.Text )
        if string.find( textAsString, OverheadSpellTransform.WordsQuickRegex ) ~= nil then
            if currentSpell == OverheadSpellTransform.WordsNum_OFF then
                for wordidx, word in ipairs(OverheadSpellTransform.Words) do
                    if textAsString == word.name then
                        SystemData.Text = L""
                        SystemData.TextSourceID = -1
                        break
                    end
                end
            elseif currentSpell == OverheadSpellTransform.WordsNum_MIXED then
                for wordidx, word in ipairs(OverheadSpellTransform.Words) do
                    if textAsString == word.name then
                        SystemData.Text = SystemData.Text..L" ["..StringToWString(word.desc)..L"]"
                        break
                    end
                end
            elseif currentSpell == OverheadSpellTransform.WordsNum_ENGLISH then
                for wordidx, word in ipairs(OverheadSpellTransform.Words) do
                    if textAsString == word.name then
                        SystemData.Text = L"["..StringToWString( word.desc )..L"]"
                        break
                    end
                end
            end
        end
    end
    OverheadSpellTransform.ShowOverheadText()
end
